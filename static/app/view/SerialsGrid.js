/*
 * File: app/view/SerialsGrid.js
 * Date: Sun Sep 11 2011 23:18:22 GMT+0200 (CEST)
 *
 * This file was generated by Ext Designer version 1.2.0.
 * http://www.sencha.com/products/designer/
 *
 * This file will be generated the first time you export.
 *
 * You should implement event handling and custom methods in this
 * class.
 */

Ext.define('TvSeries.view.SerialsGrid', {
    extend: 'TvSeries.view.ui.SerialsGrid',
    alias: 'widget.SerialsGrid',

    filterTask:  null,

    initComponent: function() {
        this.callParent(arguments);

        this.getStore().on('load', onload, this);
        this.down("#addSerialButton").on("click", this.addSerial, this);
		
        this.getSelectionModel().on('select', this.select, this);
        this.down("textfield").on('change', this.search, this);
		
        this.on('reload', this.reload, this);
                
        this.filterTask = new Ext.util.DelayedTask(this.executeSearch, this);
    },
	
    reload: function(){
        this.filterTask.cancel();
        this.getStore().load();
    },
	
    select: function(sm, record, index, opt){
        this.filterTask.cancel();            
        this.fireEvent("loadSeason", record);
    },

    addSerial: function(){
        var addwindow = Ext.create('TvSeries.view.AddSerialWindow', {
            renderTo: Ext.getBody()
        });
        addwindow.show();
        addwindow.on("close", this.reload, this);
    },
	
    search: function(){
        this.filterTask.delay(200);
    },
        
    executeSearch: function(){
        var value = this.down("textfield").getValue();
        this.getStore().getProxy().extraParams = {
            title: value
        };
        this.getStore().load();            
    }
});