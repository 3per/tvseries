/*
 * File: app/view/TvSeriesViewport.js
 * Date: Sun Sep 11 2011 23:29:53 GMT+0200 (CEST)
 *
 * This file was generated by Ext Designer version 1.2.0.
 * http://www.sencha.com/products/designer/
 *
 * This file will be generated the first time you export.
 *
 * You should implement event handling and custom methods in this
 * class.
 */

Ext.define('TvSeries.view.TvSeriesViewport', {
    extend: 'TvSeries.view.ui.TvSeriesViewport',

    showWindow: null,

    initComponent: function() {
        this.callParent(arguments);
        
        this.showWindow = Ext.create('TvSeries.view.ShowWindow', {
            renderTo: Ext.getBody()
        });

        this.registerListeners();
    },
    
    registerListeners: function(){
        this.down("SerialsGrid").getSelectionModel().on('select', function(sm, record, index, opt){
            this.loadBySerial(record.get('id'));
        }, this);
    	
        this.down("SerialsGrid").down("textfield").on('specialkey', function(field, e){
            if (e.getKey() == e.ENTER) {
                var value = field.getValue();
                var serialStore = this.down("SerialsGrid").getStore();
                serialStore.getProxy().extraParams = {
                    title: value
                };
                serialStore.load();
            }
        }, this);
    	
        this.down("SeasonsGrid").getSelectionModel().on('select', function(sm, record, index, opt){
            this.loadBySeason(record.get('id'));
        }, this);
    	
        this.down("EpisodesGrid").getSelectionModel().on('select', function(sm, record, index, opt){
            var serialRecord = this.down("SerialsGrid").getSelectionModel().getSelection();
            var seasonsRecord = this.down("SeasonsGrid").getSelectionModel().getSelection();
            this.showWindow.loadVideo(record, seasonsRecord[0], serialRecord[0], this.down("EpisodesGrid"));
        }, this);

        this.showWindow.on('hide', function(){
            this.down("EpisodesGrid").getStore().load();
        }, this);
    },
    
    loadBySerial: function(idSerial){
        var seasonsStore = this.down("SeasonsGrid").getStore();
        seasonsStore.getProxy().extraParams = {
            idSerial: idSerial
        };
        seasonsStore.load();
        
        var episodeStore = this.down("EpisodesGrid").getStore();
        episodeStore.getProxy().extraParams = {
            idSerial: idSerial
        };
        episodeStore.load();
    },
    
    loadBySeason: function(idSeason){
        var episodeStore = this.down("EpisodesGrid").getStore();
        episodeStore.getProxy().extraParams = {
            idSeason: idSeason
        };
        episodeStore.load();
    }
});